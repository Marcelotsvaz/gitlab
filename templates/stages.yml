stages:
  - !reference [ .preBuildStage, stage ]
  - !reference [ .buildStage, stage ]
  - !reference [ .testStage, stage ]
  - !reference [ .stagingStage, stage ]
  - !reference [ .testStagingStage, stage ]
  - !reference [ .cleanupStage, stage ]
  - !reference [ .deployStage, stage ]
  - !reference [ .releaseStage, stage ]



# 
# Templates.
#-------------------------------------------------------------------------------
.baseStage:
    script:
      - echo "Running job '${CI_JOB_NAME}' with an empty script."


.rules:
    onMergeRequests:
        if: $CI_PIPELINE_TYPE == 'merge_request'
    
    onTags:
        if: $CI_PIPELINE_TYPE == 'tag'



# 
# Stages.
#-------------------------------------------------------------------------------
.preBuildStage:
    stage: ğŸ› ï¸â€‡Pre Build
    
    extends: .baseStage
    
    interruptible: true


.buildStage:
    stage: ğŸ› ï¸â€‡Build
    
    extends: .baseStage
    
    interruptible: true


.testStage:
    stage: ğŸ§ªâ€‡Test
    
    extends: .baseStage
    
    interruptible: true


.stagingStage:
    stage: ğŸ—ï¸â€‡Staging
    
    extends: .baseStage
    
    rules:
      - !reference [ .rules, onMergeRequests ]


.testStagingStage:
    stage: ğŸ§ªğŸ—ï¸â€‡Test Staging
    
    extends: .baseStage
    
    rules:
      - !reference [ .rules, onMergeRequests ]


.cleanupStage:
    stage: ğŸ—‘ï¸â€‡Clean Up
    
    extends: .baseStage
    
    rules:
      - !reference [ .rules, onMergeRequests ]


.deployStage:
    stage: ğŸš€â€‡Deploy
    
    extends: .baseStage
    
    rules:
      - !reference [ .rules, onTags ]


.releaseStage:
    stage: ğŸ“¦â€‡Release
    
    extends: .baseStage
    
    rules:
      - !reference [ .rules, onTags ]