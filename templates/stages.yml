stages:
  - !reference [ .buildStage, stage ]
  - !reference [ .testStage, stage ]
  - !reference [ .stagingStage, stage ]
  - !reference [ .testStagingStage, stage ]
  - !reference [ .cleanupStage, stage ]
  - !reference [ .deployStage, stage ]
  - !reference [ .releaseStage, stage ]



# 
# Templates.
#-------------------------------------------------------------------------------
.baseStage:
    script:
      - echo "Running job '${CI_JOB_NAME}' with an empty script."


.onlyOnMergeRequests:
    rules:
      - if: $CI_PIPELINE_TYPE == 'merge_request'


.onlyOnTags:
    rules:
      - if: $CI_PIPELINE_TYPE == 'tag'



# 
# Stages.
#-------------------------------------------------------------------------------
.buildStage:
    stage: 🛠️ Build
    extends:
      - .baseStage
    
    interruptible: true


.testStage:
    stage: 🧪 Test
    extends:
      - .baseStage
    
    interruptible: true


.stagingStage:
    stage: 🏗️ Staging
    extends:
      - .baseStage
      - .onlyOnMergeRequests


.testStagingStage:
    stage: 🧪🏗️ Test Staging
    extends:
      - .baseStage
      - .onlyOnMergeRequests


.cleanupStage:
    stage: 🗑️ Clean Up
    extends:
      - .baseStage
      - .onlyOnMergeRequests


.deployStage:
    stage: 🚀 Deploy
    extends:
      - .baseStage
      - .onlyOnTags


.releaseStage:
    stage: 📦 Release
    extends:
      - .baseStage
      - .onlyOnTags